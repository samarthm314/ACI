config: null
custom:
  frequency: 8
logdir: ${path:logs,${now:%Y-%m-%d},${expname}}
expdir: ${path:${logdir},${expsubdir}}
expsubdir: !!python/object/apply:pathlib.PosixPath []
expname: ${hydra_select:runtime.choices.exp}_${hydra_select:runtime.choices.task}
seed: 0
trainer:
  config: null
  custom: {}
  total_timesteps: 500000
  max_episode_steps: 256
  n_envs: ${eval:'int(${num_cpus:} // 2)'}
  model:
    policy_kwargs:
      features_extractor_class:
        _target_: cambrian.ml.features_extractors.MjCambrianCombinedExtractor
        _partial_: true
      features_extractor_kwargs:
        normalized_image: true
        image_extractor:
          _target_: cambrian.ml.features_extractors.MjCambrianMLPExtractor
          _partial_: true
          features_dim: 16
          activation:
            _target_: torch.nn.Tanh
            _partial_: true
          architecture:
          - 4
          - 8
        share_image_extractor: true
      net_arch:
        pi:
        - 64
        - ${.0}
        vf: ${.pi}
    _target_: cambrian.ml.model.MjCambrianModel
    _partial_: true
    _convert_: all
    policy: MultiInputPolicy
    n_steps: 2048
    batch_size: ${eval:'${.n_steps} * ${trainer.n_envs} // 32'}
    learning_rate: 0.001
  callbacks:
    eval_callback:
      _target_: cambrian.ml.callbacks.MjCambrianEvalCallback
      _partial_: true
      eval_env: ???
      n_eval_episodes: ${eval_env.n_eval_episodes}
      best_model_save_path: ${expdir}
      log_path: ${expdir}
      deterministic: true
      render: true
      eval_freq: 10000
      verbose: 0
      callback_after_eval:
        _target_: cambrian.ml.callbacks.MjCambrianCallbackListWithSharedParent
        _convert_: all
        callbacks:
          stop_training_on_no_improvement_callback:
            _target_: stable_baselines3.common.callbacks.StopTrainingOnNoModelImprovement
            max_no_improvement_evals: 3
            min_evals: 0
          stop_training_on_reward_threshold_callback:
            _target_: stable_baselines3.common.callbacks.StopTrainingOnRewardThreshold
            reward_threshold: 1000.0
          plot_monitor_callback:
            _target_: cambrian.ml.callbacks.MjCambrianPlotMonitorCallback
            logdir: ${expdir}
            filename: monitor
          plot_evaluations_callback:
            _target_: cambrian.ml.callbacks.MjCambrianPlotMonitorCallback
            logdir: ${expdir}
            filename: eval_monitor
            n_episodes: ${....n_eval_episodes}
    progress_bar_callback:
      _target_: cambrian.ml.callbacks.MjCambrianProgressBarCallback
  wrappers:
    agent_env_wrapper:
      _target_: cambrian.utils.wrappers.MjCambrianSingleAgentEnvWrapper
      _partial_: true
    torch_to_numpy_wrapper:
      _target_: cambrian.utils.wrappers.MjCambrianTorchToNumpyWrapper
      _partial_: true
    frame_stack_wrapper:
      _target_: gymnasium.wrappers.FrameStackObservation
      _partial_: true
      stack_size: 10
      padding_type: zero
    constant_action_wrapper:
      _target_: cambrian.utils.wrappers.MjCambrianConstantActionWrapper
      _partial_: true
      constant_actions: {}
  prune_fn: null
  fitness_fn:
    _target_: cambrian.ml.fitness_fns.fitness_from_monitor
    _partial_: true
    monitor_csv: ${path:${expdir},eval_monitor.csv}
    n_episodes: ${oc.select:eval_env.n_eval_episodes,1}
evo: null
env:
  config: null
  custom: {}
  instance:
    _target_: cambrian.envs.MjCambrianMazeEnv
    _partial_: true
  xml:
    _target_: cambrian.utils.cambrian_xml.MjCambrianXML.parse
    _convert_: all
    xml_string: ${read:${path:${package:},models,scene.xml}}
  step_fn:
    _target_: cambrian.envs.step_fns.step_combined
    _partial_: true
    step_add_agent_qpos_to_info:
      _target_: cambrian.envs.step_fns.step_add_agent_qpos_to_info
      _partial_: true
  termination_fn:
    terminate_if_close_to_goal:
      _target_: cambrian.envs.done_fns.done_if_close_to_agents
      _partial_: true
      for_agents: ${glob:agent*,${oc.dict.keys:env.agents}}
      to_agents: ${glob:goal*,${oc.dict.keys:env.agents}}
      distance_threshold: 1.0
    _target_: cambrian.envs.done_fns.done_combined
    _partial_: true
    terminate_if_exceeds_max_episode_steps:
      _target_: cambrian.envs.done_fns.done_if_exceeds_max_episode_steps
      _partial_: true
  truncation_fn:
    truncate_if_close_to_adversary:
      _target_: cambrian.envs.done_fns.done_if_close_to_agents
      _partial_: true
      for_agents: ${glob:agent*,${oc.dict.keys:env.agents}}
      to_agents: ${glob:adversary*,${oc.dict.keys:env.agents}}
      distance_threshold: 1.0
    _target_: cambrian.envs.done_fns.done_combined
    _partial_: true
  reward_fn:
    reward_if_done:
      _target_: cambrian.envs.reward_fns.reward_fn_done
      _partial_: true
      scale_by_quickness: true
      termination_reward: 1.0
      truncation_reward: ${eval:'-${.termination_reward}'}
      disable_on_max_episode_steps: true
      for_agents: ${glob:agent*,${oc.dict.keys:env.agents}}
    penalize_if_has_contacts:
      _target_: cambrian.envs.reward_fns.reward_fn_has_contacts
      _partial_: true
      reward: -1.0
      for_agents: ${glob:agent*,${oc.dict.keys:env.agents}}
    _target_: cambrian.envs.reward_fns.reward_combined
    _partial_: true
  frame_skip: 10
  max_episode_steps: ${trainer.max_episode_steps}
  n_eval_episodes: ${eval:'max(len(${.mazes}), 1)'}
  add_overlays: true
  clear_overlays_on_reset: true
  debug_overlays_size: 0.35
  renderer:
    config: null
    custom: {}
    render_modes:
    - rgb_array
    width: null
    height: null
    fullscreen: null
    scene:
      _target_: hydra_config.utils.instance_wrapper
      instance:
        _target_: mujoco.MjvScene
        _partial_: true
        maxgeom: 10000
      flags:
      - 0
      - 0
      - 0
      - 0
      - 0
      - 0
      - 0
      - 0
      - 0
      - 1
    scene_options:
      _target_: hydra_config.utils.instance_wrapper
      instance:
        _target_: mujoco.MjvOption
      flags:
        _target_: hydra_config.utils.instance_wrapper
        instance: ${..instance}
        key: ${parent:}
        setitem: true
        locate: true
        mujoco.mjtVisFlag.mjVIS_CAMERA: 1
      geomgroup:
        _target_: hydra_config.utils.instance_wrapper
        instance: ${..instance}
        key: ${parent:}
        setitem: true
        eval: true
        slice(None): true
      sitegroup: ${.geomgroup}
    camera:
      _target_: hydra_config.utils.instance_wrapper
      instance:
        _target_: mujoco.MjvCamera
      azimuth: 180.0
      elevation: -90.0
      distance: 1.25
    use_shared_context: true
    save_mode: WEBP
  save_filename: null
  agents:
    agent:
      config: null
      custom: {}
      instance:
        _target_: cambrian.agents.MjCambrianAgentPoint
        _partial_: true
        _convert_: all
      trainable: true
      use_privileged_action: false
      overlay_color:
      - 0.0
      - 1.0
      - 1.0
      - 1.0
      overlay_size: 0.1
      xml:
        _target_: cambrian.utils.cambrian_xml.MjCambrianXML.parse
        _convert_: all
        xml_string: ${read:${path:${package:},models,agents,point.xml}}
      body_name: ${parent:}_body
      geom_name: ${parent:}_geom
      check_contacts: ${.use_contact_obs}
      init_pos:
      - null
      - null
      - null
      init_quat:
      - null
      - null
      - null
      - null
      perturb_init_pos: true
      use_action_obs: ${.trainable}
      use_contact_obs: ${.trainable}
      eyes:
        eye:
          config: null
          custom: {}
          instance:
            _target_: cambrian.eyes.multi_eye.MjCambrianMultiEye
            _partial_: true
          fov:
          - 90.0
          - 120.0
          focal: ${.single_eye.focal}
          sensorsize: ${.single_eye.sensorsize}
          resolution:
          - 32
          - 32
          coord: ${.single_eye.coord}
          orthographic: ${.single_eye.orthographic}
          noise_std: 0.0
          integration_factor: 0.3
          renderer:
            config: null
            custom: {}
            render_modes:
            - rgb_array
            width: ${..resolution.1}
            height: ${..resolution.0}
            fullscreen: null
            scene:
              _target_: hydra_config.utils.instance_wrapper
              instance:
                _target_: mujoco.MjvScene
                _partial_: true
                maxgeom: 10000
              flags:
              - 0
              - 0
              - 0
              - 0
              - 0
              - 0
              - 0
              - 0
              - 0
              - 1
            scene_options:
              _target_: hydra_config.utils.instance_wrapper
              instance:
                _target_: mujoco.MjvOption
              flags:
                _target_: hydra_config.utils.instance_wrapper
                instance: ${..instance}
                key: ${parent:}
                setitem: true
                locate: true
                mujoco.mjtVisFlag.mjVIS_CAMERA: 0
              geomgroup:
                _target_: hydra_config.utils.instance_wrapper
                instance: ${..instance}
                key: ${parent:}
                setitem: true
                eval: true
                slice(None): true
                '2': false
              sitegroup: ${.geomgroup}
            camera:
              _target_: hydra_config.utils.instance_wrapper
              instance:
                _target_: mujoco.MjvCamera
            use_shared_context: true
            save_mode: WEBP
          single_eye:
            config: null
            custom: {}
            instance:
              _target_: cambrian.eyes.eye.MjCambrianEye
              _partial_: true
            fov:
            - 45.0
            - 45.0
            focal:
            - 0.01
            - 0.01
            sensorsize:
            - ${eval:'2 * ${..focal.0} * math.tan(math.radians(${..fov.0}) / 2)'}
            - ${eval:'2 * ${..focal.1} * math.tan(math.radians(${..fov.1}) / 2)'}
            resolution:
            - 1
            - 1
            coord:
            - 0.0
            - 0.0
            orthographic: false
            noise_std: 0.1
            integration_factor: 0.6
            renderer:
              config: null
              custom: {}
              render_modes:
              - rgb_array
              width: ${..resolution.1}
              height: ${..resolution.0}
              fullscreen: null
              scene:
                _target_: hydra_config.utils.instance_wrapper
                instance:
                  _target_: mujoco.MjvScene
                  _partial_: true
                  maxgeom: 10000
                flags:
                - 0
                - 0
                - 0
                - 0
                - 0
                - 0
                - 0
                - 0
                - 0
                - 1
              scene_options:
                _target_: hydra_config.utils.instance_wrapper
                instance:
                  _target_: mujoco.MjvOption
                flags:
                  _target_: hydra_config.utils.instance_wrapper
                  instance: ${..instance}
                  key: ${parent:}
                  setitem: true
                  locate: true
                  mujoco.mjtVisFlag.mjVIS_CAMERA: 0
                geomgroup:
                  _target_: hydra_config.utils.instance_wrapper
                  instance: ${..instance}
                  key: ${parent:}
                  setitem: true
                  eval: true
                  slice(None): true
                  '2': false
                sitegroup: ${.geomgroup}
              camera:
                _target_: hydra_config.utils.instance_wrapper
                instance:
                  _target_: mujoco.MjvCamera
              use_shared_context: true
              save_mode: WEBP
          _single_eye:
            _target_: hydra_config.utils.merge_with_kwargs
            _recursive_: false
            config: ${..single_eye}
            fov: ${..fov}
            focal: ${..focal}
            sensorsize: ${..sensorsize}
            resolution: ${..resolution}
            coord: ${..coord}
            orthographic: ${..orthographic}
            noise_std: ${..single_eye.noise_std}
            integration_factor: ${..single_eye.integration_factor}
            renderer:
              width: ${..resolution.1}
              height: ${..resolution.0}
          lat_range:
          - 0.0
          - 0.0
          lon_range:
          - -15.0
          - 15.0
          num_eyes:
          - 1
          - 2
          flatten_observations: false
    goal0:
      config: null
      custom:
        size: 0.5
        top_size: ${eval:'${.size} / 2'}
        rgba: 0.2 0.8 0.2 1.0
        top_rgba: 0.2 0.8 0.2 1.0
        frequency: ${oc.select:custom.frequency,"???"}
        euler: 0 0 0
        texture_cmap: redblue
        texture: object_textures/${.texture_cmap}_vertical_${.frequency}.png
      instance:
        _target_: cambrian.agents.point.MjCambrianAgentPointSeeker
        _partial_: true
        _convert_: all
        speed: -0.9
        target: null
      trainable: false
      use_privileged_action: true
      overlay_color:
      - 0.2
      - 0.8
      - 0.2
      - 1.0
      overlay_size: 0.1
      xml:
        _target_: cambrian.utils.cambrian_xml.MjCambrianXML.parse
        _convert_: all
        xml_string: ${read:${path:${package:},models,agents,point.xml}}
        overrides:
        - mujoco:
          - worldbody:
            - body:
              - name: ${parent:xml}_body
              - pos: 0 0 0.5
              - site:
                - name: ${parent:xml}_site
                - size: '0.5'
                - euler: ${custom:euler}
              - site:
                - name: ${parent:xml}_top_site
                - material: ${parent:xml}_top_mat
                - pos: 0 0 0.5
                - size: '0.2'
                - group: '2'
          - asset:
            - texture:
              - name: ${parent:xml}_tex
              - file: ${custom:texture}
              - type: 2d
            - material:
              - name: ${parent:xml}_mat
              - texture: ${parent:xml}_tex
              - emission: '2'
              - rgba: 1 1 1 1
            - material:
              - name: ${parent:xml}_top_mat
              - emission: '2'
              - rgba: ${custom:top_rgba}
      body_name: ${parent:}_body
      geom_name: ${parent:}_geom
      check_contacts: ${.use_contact_obs}
      init_pos:
      - null
      - null
      - null
      init_quat:
      - null
      - null
      - null
      - null
      perturb_init_pos: true
      use_action_obs: ${.trainable}
      use_contact_obs: ${.trainable}
      eyes: {}
    adversary0:
      config: null
      custom:
        size: 0.5
        top_size: ${eval:'${.size} / 2'}
        rgba: 0.2 0.8 0.2 1.0
        top_rgba: 0.8 0.2 0.2 1.0
        frequency: ${oc.select:custom.frequency,"???"}
        euler: 0 90 0
        texture_cmap: redblue
        texture: object_textures/${.texture_cmap}_vertical_${.frequency}.png
      instance:
        _target_: cambrian.agents.point.MjCambrianAgentPointSeeker
        _partial_: true
        _convert_: all
        speed: -0.9
        target: null
      trainable: false
      use_privileged_action: true
      overlay_color:
      - 0.8
      - 0.2
      - 0.2
      - 1.0
      overlay_size: 0.1
      xml:
        _target_: cambrian.utils.cambrian_xml.MjCambrianXML.parse
        _convert_: all
        xml_string: ${read:${path:${package:},models,agents,point.xml}}
        overrides:
        - mujoco:
          - worldbody:
            - body:
              - name: ${parent:xml}_body
              - pos: 0 0 0.5
              - site:
                - name: ${parent:xml}_site
                - size: '0.5'
                - euler: ${custom:euler}
              - site:
                - name: ${parent:xml}_top_site
                - material: ${parent:xml}_top_mat
                - pos: 0 0 0.5
                - size: '0.2'
                - group: '2'
          - asset:
            - texture:
              - name: ${parent:xml}_tex
              - file: ${custom:texture}
              - type: 2d
            - material:
              - name: ${parent:xml}_mat
              - texture: ${parent:xml}_tex
              - emission: '2'
              - rgba: 1 1 1 1
            - material:
              - name: ${parent:xml}_top_mat
              - emission: '2'
              - rgba: ${custom:top_rgba}
      body_name: ${parent:}_body
      geom_name: ${parent:}_geom
      check_contacts: ${.use_contact_obs}
      init_pos:
      - null
      - null
      - null
      init_quat:
      - null
      - null
      - null
      - null
      perturb_init_pos: true
      use_action_obs: ${.trainable}
      use_contact_obs: ${.trainable}
      eyes: {}
  mazes:
    maze:
      config: null
      custom: {}
      xml:
        _target_: cambrian.utils.cambrian_xml.MjCambrianXML.parse
        _convert_: all
        xml_string: ${read:${path:${package:},models,mazes,maze.xml}}
      map: "[\n  [1, 1,   1,   1,   1,   1,   1, 1, 1],\n  [1, 0,   R,   R,   R,   R,
        \  R, 0, 1],\n  [1, R,   0,   0,   0,   0,   0, R, 1],\n  [1, R, R:O, R:O,
        R:O, R:O, R:O, R, 1],\n  [1, R, R:O, R:O,   R, R:O, R:O, R, 1],\n  [1, R,
        R:O, R:O, R:O, R:O, R:O, R, 1],\n  [1, R, R:O, R:O,   R, R:O, R:O, R, 1],\n
        \ [1, R, R:O, R:O, R:O, R:O, R:O, R, 1],\n  [1, R,   0,   0,   0,   0,   0,
        R, 1],\n  [1, 0,   R,   R,   R,   R,   R, 0, 1],\n  [1, 1,   1,   1,   1,
        \  1,   1, 1, 1],\n]"
      scale: 2.0
      height: 0.5
      hflip: false
      vflip: false
      rotation: 0.0
      wall_texture_map:
        default:
        - vertical_10
      agent_id_map:
        default: ${glob:agent*,${oc.dict.keys:env.agents}}
        O: ${glob:goal*|adversary*,${oc.dict.keys:env.agents}}
      enabled: true
  maze_selection_fn:
    _target_: cambrian.envs.maze_env.MjCambrianMazeStore.select_maze_cycle
    _partial_: true
eval_env:
  _target_: hydra_config.utils.merge_with_kwargs
  _recursive_: false
  config: ${env}
  n_eval_episodes: 6
  save_filename: eval
  step_fn:
    respawn_objects_if_agent_close:
      _target_: cambrian.envs.step_fns.step_respawn_agents_if_close_to_agents
      _partial_: true
      for_agents: ${glob:goal*|adversary*,${oc.dict.keys:env.agents}}
      to_agents: ${glob:agent*,${oc.dict.keys:env.agents}}
      distance_threshold: 1.0
  reward_fn:
    reward_if_goal_respawned:
      _target_: cambrian.envs.reward_fns.reward_fn_agent_respawned
      _partial_: true
      reward: 10.0
      for_agents: ${glob:goal*,${oc.dict.keys:env.agents}}
      scale_by_quickness: true
    penalize_if_adversary_respawned:
      _target_: cambrian.envs.reward_fns.reward_fn_agent_respawned
      _partial_: true
      reward: -20.0
      for_agents: ${glob:adversary*,${oc.dict.keys:env.agents}}
      scale_by_quickness: true
    penalize_if_has_contacts:
      reward: -2.0
  truncation_fn:
    truncate_if_close_to_adversary:
      disable: true
  termination_fn:
    terminate_if_close_to_goal:
      disable: true
